<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>4.4. Wrapper mode &#8212; Mroonga v13.01 documentation</title>
    <link rel="stylesheet" type="text/css" href="../static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../static/mroonga.css" />
    
    <script data-url_root="../" id="documentation_options" src="../static/documentation_options.js"></script>
    <script src="../static/jquery.js"></script>
    <script src="../static/underscore.js"></script>
    <script src="../static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../static/doctools.js"></script>
    <script src="../static/sphinx_highlight.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5. Reference" href="../reference.html" />
    <link rel="prev" title="4.3. Storage mode" href="storage.html" /> 
      <meta property="fb:page_id" content="238184682903165" /><!-- mroonga -->
    <meta property="fb:admins" content="664204556" /><!-- kouhei.sutou -->
    <meta property="og:type" content="product" />
    <meta property="og:image" content="http://mroonga.org/images/logos/mroonga-icon-full-size.png" />
    <meta property="og:site_name" content="mroonga" />

    <link rel="stylesheet" href="/css/sphinx.css" type="text/css" />
  </head>
  <body>
    <div id="fb-root"></div>

<div class="header">
  <h1 class="title">
    <a id="top-link" href="../../">
      <span class="project">mroonga</span>
      <span class="separator">-</span>
      <span class="description">An open-source storage engine for fast fulltext search with MySQL.</span>
    </a>
  </h1>

      <div class="facebook-buttons">
      <fb:like href="http://www.facebook.com/pages/mroonga/238184682903165"
               layout="standard"
               width="290"></fb:like>
    </div>
    <div class="other-language-links">

    <ul>
      <li><a href="../../ja/docs/tutorial/wrapper.html" title="日本語">日本語</a></li>
    </ul>
  </div>
</div>
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../reference.html" title="5. Reference"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="storage.html" title="4.3. Storage mode"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Mroonga v13.01 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../tutorial.html" accesskey="U"><span class="section-number">4. </span>Tutorial</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">4.4. </span>Wrapper mode</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="wrapper-mode">
<h1><span class="section-number">4.4. </span>Wrapper mode<a class="headerlink" href="#wrapper-mode" title="Permalink to this heading">¶</a></h1>
<p>Here we explain how to use wrapper mode of Mroonga</p>
<section id="how-to-use-wrapper-mode">
<h2><span class="section-number">4.4.1. </span>How to use wrapper mode<a class="headerlink" href="#how-to-use-wrapper-mode" title="Permalink to this heading">¶</a></h2>
<p>In wrapper mode, Mroonga works in wrapping an existing storage engine. To specify the wrapped storage engine, we use SQL comment like <code class="docutils literal notranslate"><span class="pre">COMMENT</span> <span class="pre">=</span> <span class="pre">'engine</span> <span class="pre">&quot;InnoDB&quot;'</span></code> for now.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For now, a primary key is mandatory in wrapper mode. That is not the case with storage mode.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Wrapper mode supports the followings, that are not supported in storage mode for now.</p>
<ul class="simple">
<li><p>null value</p></li>
<li><p>transaction (if storage engine supports. Note that rollback causes mismatch of indexes, it may affects search results, so recreate index of Mroonga in such a case.)</p></li>
</ul>
</div>
</section>
<section id="how-to-use-full-text-search">
<h2><span class="section-number">4.4.2. </span>How to use full text search<a class="headerlink" href="#how-to-use-full-text-search" title="Permalink to this heading">¶</a></h2>
<p>After confirming the installation, let’s create a table. The important point is to specify Mroonga by <code class="docutils literal notranslate"><span class="pre">ENGINE</span> <span class="pre">=</span> <span class="pre">Mroonga</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">diaries</span> <span class="p">(</span>
    <span class="o">-&gt;</span>   <span class="nb">id</span> <span class="n">INT</span> <span class="n">PRIMARY</span> <span class="n">KEY</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
    <span class="o">-&gt;</span>   <span class="n">content</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="o">-&gt;</span>   <span class="n">FULLTEXT</span> <span class="n">INDEX</span> <span class="p">(</span><span class="n">content</span><span class="p">)</span>
    <span class="o">-&gt;</span> <span class="p">)</span> <span class="n">ENGINE</span> <span class="o">=</span> <span class="n">Mroonga</span> <span class="n">COMMENT</span> <span class="o">=</span> <span class="s1">&#39;engine &quot;InnoDB&quot;&#39;</span> <span class="n">DEFAULT</span> <span class="n">CHARSET</span> <span class="n">utf8</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="n">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.52</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
</div>
<p>We put data by INSERT.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">diaries</span> <span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="n">VALUES</span> <span class="p">(</span><span class="s2">&quot;It&#39;ll be fine tomorrow.&quot;</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.01</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span> <span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">diaries</span> <span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="n">VALUES</span> <span class="p">(</span><span class="s2">&quot;It&#39;ll rain tomorrow&quot;</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
</div>
<p>Try full text search.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">diaries</span> <span class="n">WHERE</span> <span class="n">MATCH</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="n">AGAINST</span><span class="p">(</span><span class="s2">&quot;+fine&quot;</span> <span class="n">IN</span> <span class="n">BOOLEAN</span> <span class="n">MODE</span><span class="p">);</span>
<span class="o">+----+-----------------------------------------+</span>
<span class="o">|</span> <span class="nb">id</span> <span class="o">|</span> <span class="n">content</span>                                 <span class="o">|</span>
<span class="o">+----+-----------------------------------------+</span>
<span class="o">|</span>  <span class="mi">1</span> <span class="o">|</span> <span class="n">It</span><span class="s1">&#39;ll be fine tomorrow. |</span>
<span class="o">+----+-----------------------------------------+</span>
<span class="mi">1</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">set</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
</div>
<p>Yes, full text search works.</p>
</section>
<section id="how-to-get-search-score">
<h2><span class="section-number">4.4.3. </span>How to get search score<a class="headerlink" href="#how-to-get-search-score" title="Permalink to this heading">¶</a></h2>
<p>We often want to display more relevant results first in full text search. We use search score in such case.</p>
<p>We can get search score by MySQL’s standard way <a class="footnote-reference brackets" href="#score" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>, i.e. we use MATCH…AGAINST in one of columns in SELECT or ORDER BY.</p>
<p>Let’s try.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">diaries</span> <span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="n">VALUES</span> <span class="p">(</span><span class="s2">&quot;It&#39;s fine today. It&#39;ll be fine tomorrow as well.&quot;</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span> <span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">diaries</span> <span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="n">VALUES</span> <span class="p">(</span><span class="s2">&quot;It&#39;s fine today. But it&#39;ll rain tomorrow.&quot;</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="o">*</span><span class="p">,</span> <span class="n">MATCH</span> <span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="n">AGAINST</span> <span class="p">(</span><span class="s2">&quot;+fine&quot;</span> <span class="n">IN</span> <span class="n">BOOLEAN</span> <span class="n">MODE</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">diaries</span> <span class="n">WHERE</span> <span class="n">MATCH</span> <span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="n">AGAINST</span> <span class="p">(</span><span class="s2">&quot;+fine&quot;</span> <span class="n">IN</span> <span class="n">BOOLEAN</span> <span class="n">MODE</span><span class="p">)</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">MATCH</span> <span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="n">AGAINST</span> <span class="p">(</span><span class="s2">&quot;+fine&quot;</span> <span class="n">IN</span> <span class="n">BOOLEAN</span> <span class="n">MODE</span><span class="p">)</span> <span class="n">DESC</span><span class="p">;</span>
<span class="o">+----+--------------------------------------------------+---------------------------------------------------+</span>
<span class="o">|</span> <span class="nb">id</span> <span class="o">|</span> <span class="n">content</span>                                          <span class="o">|</span> <span class="n">MATCH</span> <span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="n">AGAINST</span> <span class="p">(</span><span class="s2">&quot;+fine&quot;</span> <span class="n">IN</span> <span class="n">BOOLEAN</span> <span class="n">MODE</span><span class="p">)</span> <span class="o">|</span>
<span class="o">+----+--------------------------------------------------+---------------------------------------------------+</span>
<span class="o">|</span>  <span class="mi">3</span> <span class="o">|</span> <span class="n">It</span><span class="s1">&#39;s fine today. It&#39;</span><span class="n">ll</span> <span class="n">be</span> <span class="n">fine</span> <span class="n">tomorrow</span> <span class="k">as</span> <span class="n">well</span><span class="o">.</span> <span class="o">|</span>                                                 <span class="mi">2</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span> <span class="o">|</span> <span class="n">It</span><span class="s1">&#39;ll be fine tomorrow.                          |                                                 1 |</span>
<span class="o">|</span>  <span class="mi">4</span> <span class="o">|</span> <span class="n">It</span><span class="s1">&#39;s fine today. But it&#39;</span><span class="n">ll</span> <span class="n">rain</span> <span class="n">tomorrow</span><span class="o">.</span>        <span class="o">|</span>                                                 <span class="mi">1</span> <span class="o">|</span>
<span class="o">+----+--------------------------------------------------+---------------------------------------------------+</span>
<span class="mi">3</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">set</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
</div>
<p>The result having the search word <code class="docutils literal notranslate"><span class="pre">fine</span></code> more, i.e. <code class="docutils literal notranslate"><span class="pre">id</span> <span class="pre">=</span> <span class="pre">3</span></code> message having the higher search score, is displayed first. And you also get search score by using MATCH AGAINST in SELECT phrase.</p>
<p>You can use <code class="docutils literal notranslate"><span class="pre">AS</span></code> to change the attribute name.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="o">*</span><span class="p">,</span> <span class="n">MATCH</span> <span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="n">AGAINST</span> <span class="p">(</span><span class="s2">&quot;+fine&quot;</span> <span class="n">IN</span> <span class="n">BOOLEAN</span> <span class="n">MODE</span><span class="p">)</span> <span class="n">AS</span> <span class="n">score</span> <span class="n">FROM</span> <span class="n">diaries</span> <span class="n">WHERE</span> <span class="n">MATCH</span> <span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="n">AGAINST</span> <span class="p">(</span><span class="s2">&quot;+fine&quot;</span> <span class="n">IN</span> <span class="n">BOOLEAN</span> <span class="n">MODE</span><span class="p">)</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">MATCH</span> <span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="n">AGAINST</span> <span class="p">(</span><span class="s2">&quot;+fine&quot;</span> <span class="n">IN</span> <span class="n">BOOLEAN</span> <span class="n">MODE</span><span class="p">)</span> <span class="n">DESC</span><span class="p">;</span>
<span class="o">+----+--------------------------------------------------+-------+</span>
<span class="o">|</span> <span class="nb">id</span> <span class="o">|</span> <span class="n">content</span>                                          <span class="o">|</span> <span class="n">score</span> <span class="o">|</span>
<span class="o">+----+--------------------------------------------------+-------+</span>
<span class="o">|</span>  <span class="mi">3</span> <span class="o">|</span> <span class="n">It</span><span class="s1">&#39;s fine today. It&#39;</span><span class="n">ll</span> <span class="n">be</span> <span class="n">fine</span> <span class="n">tomorrow</span> <span class="k">as</span> <span class="n">well</span><span class="o">.</span> <span class="o">|</span>     <span class="mi">2</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span> <span class="o">|</span> <span class="n">It</span><span class="s1">&#39;ll be fine tomorrow.                          |     1 |</span>
<span class="o">|</span>  <span class="mi">4</span> <span class="o">|</span> <span class="n">It</span><span class="s1">&#39;s fine today. But it&#39;</span><span class="n">ll</span> <span class="n">rain</span> <span class="n">tomorrow</span><span class="o">.</span>        <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>
<span class="o">+----+--------------------------------------------------+-------+</span>
<span class="mi">3</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">set</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="how-to-specify-the-parser-for-full-text-search">
<h2><span class="section-number">4.4.4. </span>How to specify the parser for full text search<a class="headerlink" href="#how-to-specify-the-parser-for-full-text-search" title="Permalink to this heading">¶</a></h2>
<p>MySQL has the following syntax to specify the parser <a class="footnote-reference brackets" href="#parser" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a> for full text search.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FULLTEXT</span> <span class="n">INDEX</span> <span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="n">WITH</span> <span class="n">PARSER</span> <span class="n">parser_name</span>
</pre></div>
</div>
<p>To use this syntax, you need to register all parsers in MySQL beforehand. On the other hand, Groonga can dynamically add a tokenizer, that is a parser in MySQL. So if use this syntax in Mroonga, tokenizers that are added in Groonga dynamically cannot be supported. We think that this limitation decreases the convenience, and we choose our own syntax using COMMENT like the following.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FULLTEXT</span> <span class="n">INDEX</span> <span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="n">COMMENT</span> <span class="s1">&#39;tokenizer &quot;TokenMecab&quot;&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">COMMENT</span></code> in <code class="docutils literal notranslate"><span class="pre">FULLTEXT</span> <span class="pre">INDEX</span></code> is only supported MySQL 5.5 or later. If you use MySQL 5.1, use <code class="docutils literal notranslate"><span class="pre">mroonga_default_parser</span></code> variable described below.</p>
</div>
<p>You can specify one of following values as the tokenizer.</p>
<table class="docutils align-default" id="id3">
<caption><span class="caption-text">Available tokenizers</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Tokenizer</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">off</span></code></p></td>
<td><p>(<code class="docutils literal notranslate"><span class="pre">Deprecated</span></code>) It does not tokenize at all. Use <code class="docutils literal notranslate"><span class="pre">off</span></code> if you want to treat
<code class="docutils literal notranslate"><span class="pre">content</span></code> as is. For example, this value is used for prefix
search.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">none</span></code></p></td>
<td><div class="versionadded">
<p><span class="versionmodified added">New in version 8.07: </span>It does not tokenize at all. Use <code class="docutils literal notranslate"><span class="pre">none</span></code> if you want to treat <code class="docutils literal notranslate"><span class="pre">content</span></code> as is. For example, this value is used for prefix search.</p>
</div>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TokenBigram</span></code></p></td>
<td><p>It tokenises in bigram. But continuous alphabets, numbers or
symbols are treated as a token. So there can exist tokes with 3
letters or more. It is to reduce noises.</p>
<p>This is the default value.</p>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TokenMecab</span></code></p></td>
<td><p>It tokenises using MeCab. Groonga should be built with MeCab
support.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TokenBigramSplitSymbol</span></code></p></td>
<td><p>It tokenises in bigram. Unlike <code class="docutils literal notranslate"><span class="pre">TokenBigram</span></code>, continuous
symbols are not treated as a token, but tokenised in bigram.</p>
<p>When you use <code class="docutils literal notranslate"><span class="pre">TokenBigramSplitSymbol</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">TokenBigram</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;!?&quot;</span></code> can match <code class="docutils literal notranslate"><span class="pre">&quot;!?!?!?&quot;</span></code> in <code class="docutils literal notranslate"><span class="pre">&quot;Is</span> <span class="pre">it</span>
<span class="pre">really!?!?!?&quot;</span></code>. But when you use <code class="docutils literal notranslate"><span class="pre">TokenBigram</span></code>, only
<code class="docutils literal notranslate"><span class="pre">&quot;!?!?!?&quot;</span></code> can match as well.</p>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TokenBigramSplitSymbolAlpha</span></code></p></td>
<td><p>It tokenise in bigram. In addition to <code class="docutils literal notranslate"><span class="pre">TokenBigramSplitSymbol</span></code>,
continuous alphabets are not treated as a token either, but
tokenised in bigram.</p>
<p>When you use <code class="docutils literal notranslate"><span class="pre">TokenBigramSplitSymbolAlpha</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">TokenBigram</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;real&quot;</span></code> can match <code class="docutils literal notranslate"><span class="pre">&quot;Is</span> <span class="pre">it</span> <span class="pre">really?&quot;</span></code>. But
when you use <code class="docutils literal notranslate"><span class="pre">TokenBigram</span></code>, only <code class="docutils literal notranslate"><span class="pre">&quot;really&quot;</span></code> can match as well.</p>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TokenBigramSplitSymbolAlphaDigit</span></code></p></td>
<td><p>It tokenise in bigram. In addition to
<code class="docutils literal notranslate"><span class="pre">TokenBigramSplitSymbolAlpha</span></code>, continuous numbers are not treated
as a token either, but tokenised in bigram. So any kind of
characters are treated equally in bigram.</p>
<p>When you use <code class="docutils literal notranslate"><span class="pre">TokenBigramSplitSymbolAlphaDigit</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">TokenBigram</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;567&quot;</span></code> can match <code class="docutils literal notranslate"><span class="pre">&quot;090-0123-4567&quot;</span></code>. But
when you use <code class="docutils literal notranslate"><span class="pre">TokenBigram</span></code>, only <code class="docutils literal notranslate"><span class="pre">&quot;4567&quot;</span></code> can match as well.</p>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TokenBigramIgnoreBlank</span></code></p></td>
<td><p>It tokenise in bigram. Unlike <code class="docutils literal notranslate"><span class="pre">TokenBigram</span></code>, it ignores white
spaces.</p>
<p>When you use <code class="docutils literal notranslate"><span class="pre">TokenBigramIgnoreBlank</span></code> instead of <code class="docutils literal notranslate"><span class="pre">TokenBigram</span></code>,
<code class="docutils literal notranslate"><span class="pre">&quot;みなさん&quot;</span></code> can match <code class="docutils literal notranslate"><span class="pre">&quot;み</span> <span class="pre">な</span> <span class="pre">さ</span> <span class="pre">ん</span> <span class="pre">注</span> <span class="pre">目&quot;</span></code>. But when you use
<code class="docutils literal notranslate"><span class="pre">TokenBigram</span></code>, only <code class="docutils literal notranslate"><span class="pre">&quot;み</span> <span class="pre">な</span> <span class="pre">さ</span> <span class="pre">ん&quot;</span></code> can match as well.</p>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TokenBigramIgnoreBlankSplitSymbol</span></code></p></td>
<td><p>It tokenise in bigram. Unlike <code class="docutils literal notranslate"><span class="pre">TokenBigramSplitSymbol</span></code>, it
ignores white spaces.</p>
<p>When you use <code class="docutils literal notranslate"><span class="pre">TokenBigramIgnoreBlankSplitSymbol</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">TokenBigramSplitSymbol</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;???&quot;</span></code> can match <code class="docutils literal notranslate"><span class="pre">&quot;!</span> <span class="pre">?</span>
<span class="pre">???&quot;</span></code>. But when you use <code class="docutils literal notranslate"><span class="pre">TokenBigramSplitSymbol</span></code>, only <code class="docutils literal notranslate"><span class="pre">&quot;?</span>
<span class="pre">??&quot;</span></code> can match as well.</p>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TokenBigramIgnoreBlankSplitSymbolAlpha</span></code></p></td>
<td><p>It tokenise in bigram. Unlike <code class="docutils literal notranslate"><span class="pre">TokenBigramSplitSymbolAlpha</span></code>,
it ignores white spaces.</p>
<p>When you use <code class="docutils literal notranslate"><span class="pre">TokenBigramIgnoreBlankSplitSymbolAlpha</span></code> instead
of <code class="docutils literal notranslate"><span class="pre">TokenBigramSplitSymbolAlpha</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;ama&quot;</span></code> can match <code class="docutils literal notranslate"><span class="pre">&quot;I</span> <span class="pre">am</span>
<span class="pre">a</span> <span class="pre">pen.&quot;</span></code>. But when you use <code class="docutils literal notranslate"><span class="pre">TokenBigramSplitSymbolAlpha</span></code>,
only <code class="docutils literal notranslate"><span class="pre">&quot;am</span> <span class="pre">a&quot;</span></code> can match as well.</p>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TokenBigramIgnoreBlankSplitSymbolAlphaDigit</span></code></p></td>
<td><p>It tokenise in bigram. Unlike
<code class="docutils literal notranslate"><span class="pre">TokenBigramSplitSymbolAlphaDigit</span></code>, it ignores white spaces.</p>
<p>When you use <code class="docutils literal notranslate"><span class="pre">TokenBigramIgnoreBlankSplitSymbolAlphaDigit</span></code>
instead of <code class="docutils literal notranslate"><span class="pre">TokenBigramSplitSymbolAlphaDigit</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;9001&quot;</span></code> can
match <code class="docutils literal notranslate"><span class="pre">&quot;090</span> <span class="pre">0123</span> <span class="pre">4567&quot;</span></code>. But when you use
<code class="docutils literal notranslate"><span class="pre">TokenBigramSplitSymbolAlphaDigit</span></code>, only <code class="docutils literal notranslate"><span class="pre">&quot;90</span> <span class="pre">01&quot;</span></code> can
match as well.</p>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TokenDelimit</span></code></p></td>
<td><p>It tokenise by splitting with a white space.</p>
<p><code class="docutils literal notranslate"><span class="pre">&quot;movie</span> <span class="pre">horror</span> <span class="pre">topic&quot;</span></code> will be tokenised as <code class="docutils literal notranslate"><span class="pre">&quot;movie&quot;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&quot;horror&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;topic&quot;</span></code>.</p>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TokenDelimitNull</span></code></p></td>
<td><p>It tokenise by splitting with a null character (<code class="docutils literal notranslate"><span class="pre">\\0</span></code>).</p>
<p><code class="docutils literal notranslate"><span class="pre">&quot;movie\\0horror\\0topic&quot;</span></code> will be tokenised as <code class="docutils literal notranslate"><span class="pre">&quot;movie&quot;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&quot;horror&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;topic&quot;</span></code>.</p>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TokenUnigram</span></code></p></td>
<td><p>It tokenises in unigram. But continuous alphabets, numbers or
symbols are treated as a token. So there can exist tokes with 2
letters or more. It is to reduce noises.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TokenTrigram</span></code></p></td>
<td><p>It tokenises in trigram. But continuous alphabets, numbers or
symbols are treated as a token. So there can exist tokes with 4
letters or more. It is to reduce noises.</p></td>
</tr>
</tbody>
</table>
<p>You can specify the default tokenizer by passing <code class="docutils literal notranslate"><span class="pre">--with-default-tokenizer</span></code> option in <code class="docutils literal notranslate"><span class="pre">configure</span></code> when you build Mroonga.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">configure</span> <span class="o">--</span><span class="k">with</span><span class="o">-</span><span class="n">default</span><span class="o">-</span><span class="n">tokenizer</span> <span class="n">TokenMecab</span> <span class="o">...</span>
</pre></div>
</div>
<p>Or you can set <code class="docutils literal notranslate"><span class="pre">mroonga_default_tokenizer</span></code> variable in my.cnf or by SQL. If you specify it in my.cnf, the change will not be lost after restarting MySQL, but you need to restart MySQL to make it effective. On the other hand, if you set it in SQL, the change is effective immediately, but it will be lost when you restart MySQL.</p>
<p>my.cnf:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">mysqld</span><span class="p">]</span>
<span class="n">mroonga_default_tokenizer</span><span class="o">=</span><span class="n">TokenMecab</span>
</pre></div>
</div>
<p>SQL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">SET</span> <span class="n">GLOBAL</span> <span class="n">mroonga_default_tokenizer</span> <span class="o">=</span> <span class="n">TokenMecab</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="n">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="how-to-specify-the-normalizer">
<h2><span class="section-number">4.4.5. </span>How to specify the normalizer<a class="headerlink" href="#how-to-specify-the-normalizer" title="Permalink to this heading">¶</a></h2>
<p>Mroonga uses normalizer corresponding to the encoding of document.
It is used when tokenizing text and storing table key.</p>
<p>It is used <code class="docutils literal notranslate"><span class="pre">NormalizerMySQLGeneralCI</span></code> normalizer when the encoding is
<code class="docutils literal notranslate"><span class="pre">utf8_general_ci</span></code> or <code class="docutils literal notranslate"><span class="pre">utf8mb4_general_ci</span></code>.</p>
<p>It is used <code class="docutils literal notranslate"><span class="pre">NormalizerMySQLUnicodeCI</span></code> normalizer when the encoding is
<code class="docutils literal notranslate"><span class="pre">utf8_unicode_ci</span></code> or <code class="docutils literal notranslate"><span class="pre">utf8mb4_unicode_ci</span></code>.</p>
<p>It isn’t used normalizer when the encoding is <code class="docutils literal notranslate"><span class="pre">utf8_bin</span></code>.</p>
<p>Here is an example that uses <code class="docutils literal notranslate"><span class="pre">NormalizerMySQLUnicodeCI</span></code> normalizer by specifying <code class="docutils literal notranslate"><span class="pre">utf8_unicode_ci</span></code>.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>mysql&gt; SET NAMES utf8;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; CREATE TABLE diaries (
    -&gt;   day DATE PRIMARY KEY,
    -&gt;   content VARCHAR(64) NOT NULL,
    -&gt;   FULLTEXT INDEX (content)
    -&gt; ) Engine=Mroonga DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
Query OK, 0 rows affected (0.18 sec)

mysql&gt; INSERT INTO diaries VALUES (&quot;2013-04-23&quot;, &quot;ブラックコーヒーを飲んだ。&quot;);
Query OK, 1 row affected (0.00 sec)

mysql&gt; SELECT * FROM diaries
    -&gt;        WHERE MATCH (content) AGAINST (&quot;+ふらつく&quot; IN BOOLEAN MODE);
+------------+-----------------------------------------+
| day        | content                                 |
+------------+-----------------------------------------+
| 2013-04-23 | ブラックコーヒーを飲んだ。 |
+------------+-----------------------------------------+
1 row in set (0.00 sec)

mysql&gt; SELECT * FROM diaries
    -&gt;        WHERE MATCH (content) AGAINST (&quot;+ﾌﾞﾗｯｸ&quot; IN BOOLEAN MODE);
+------------+-----------------------------------------+
| day        | content                                 |
+------------+-----------------------------------------+
| 2013-04-23 | ブラックコーヒーを飲んだ。 |
+------------+-----------------------------------------+
1 row in set (0.00 sec)
</pre></div>
</div>
<p>Mroonga has the following syntax to specify Groonga’s normalizer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FULLTEXT</span> <span class="n">INDEX</span> <span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="n">COMMENT</span> <span class="s1">&#39;normalizer &quot;NormalizerAuto&quot;&#39;</span>
</pre></div>
</div>
<p>See <a class="reference external" href="http://groonga.org/docs/reference/normalizers.html">Groonga’s documentation about normalizer</a> for more details.</p>
<p>Here is an example that uses <code class="docutils literal notranslate"><span class="pre">NormalizerAuto</span></code> normalizer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>mysql&gt; SET NAMES utf8;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; CREATE TABLE diaries (
    -&gt;   day DATE PRIMARY KEY,
    -&gt;   content VARCHAR(64) NOT NULL,
    -&gt;   FULLTEXT INDEX (content) COMMENT &#39;normalizer &quot;NormalizerAuto&quot;&#39;
    -&gt; ) Engine=Mroonga DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
Query OK, 0 rows affected (0.19 sec)

mysql&gt; INSERT INTO diaries VALUES (&quot;2013-04-23&quot;, &quot;ブラックコーヒーを飲んだ。&quot;);
Query OK, 1 row affected (0.00 sec)

mysql&gt; SELECT * FROM diaries
    -&gt;        WHERE MATCH (content) AGAINST (&quot;+ふらつく&quot; IN BOOLEAN MODE);
Empty set (0.00 sec)

mysql&gt; SELECT * FROM diaries
    -&gt;        WHERE MATCH (content) AGAINST (&quot;+ﾌﾞﾗｯｸ&quot; IN BOOLEAN MODE);
+------------+-----------------------------------------+
| day        | content                                 |
+------------+-----------------------------------------+
| 2013-04-23 | ブラックコーヒーを飲んだ。 |
+------------+-----------------------------------------+
1 row in set (0.00 sec)
</pre></div>
</div>
</section>
<section id="how-to-get-snippet-keyword-in-context">
<h2><span class="section-number">4.4.6. </span>How to get snippet (Keyword in context)<a class="headerlink" href="#how-to-get-snippet-keyword-in-context" title="Permalink to this heading">¶</a></h2>
<p>Mroonga provides functionality to get keyword in context.
It is implemented as <a class="reference internal" href="../reference/udf/mroonga_snippet.html"><span class="doc">mroonga_snippet()</span></a> UDF.</p>
</section>
<section id="logging">
<h2><span class="section-number">4.4.7. </span>Logging<a class="headerlink" href="#logging" title="Permalink to this heading">¶</a></h2>
<p>Mroonga outputs the logs by default.</p>
<p>Log files are located in MySQL’s data directory with the filename  <code class="docutils literal notranslate"><span class="pre">groonga.log</span></code>.</p>
<p>Here is the example of the log.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2010</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">07</span> <span class="mi">17</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">39.209379</span><span class="o">|</span><span class="n">n</span><span class="o">|</span><span class="n">b1858f80</span><span class="o">|</span><span class="n">mroonga</span> <span class="mf">1.10</span> <span class="n">started</span><span class="o">.</span>
<span class="mi">2010</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">07</span> <span class="mi">17</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">44.934048</span><span class="o">|</span><span class="n">d</span><span class="o">|</span><span class="mi">46953940</span><span class="o">|</span><span class="nb">hash</span> <span class="n">get</span> <span class="ow">not</span> <span class="n">found</span> <span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">test</span><span class="p">)</span>
<span class="mi">2010</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">07</span> <span class="mi">17</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">44.936113</span><span class="o">|</span><span class="n">d</span><span class="o">|</span><span class="mi">46953940</span><span class="o">|</span><span class="nb">hash</span> <span class="n">put</span> <span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">test</span><span class="p">)</span>
</pre></div>
</div>
<p>The default log level is NOTICE, i.e. we have important information only and we don’t have debug information etc.).</p>
<p>You can get the log level by <code class="docutils literal notranslate"><span class="pre">mroonga_log_level</span></code> system variable, that is a global variable. You can also modify it dynamically by using SET phrase.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">SHOW</span> <span class="n">VARIABLES</span> <span class="n">LIKE</span> <span class="s1">&#39;mroonga_log_level&#39;</span><span class="p">;</span>
<span class="o">+-------------------+--------+</span>
<span class="o">|</span> <span class="n">Variable_name</span>     <span class="o">|</span> <span class="n">Value</span>  <span class="o">|</span>
<span class="o">+-------------------+--------+</span>
<span class="o">|</span> <span class="n">mroonga_log_level</span> <span class="o">|</span> <span class="n">NOTICE</span> <span class="o">|</span>
<span class="o">+-------------------+--------+</span>
<span class="mi">1</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">set</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span> <span class="n">SET</span> <span class="n">GLOBAL</span> <span class="n">mroonga_log_level</span><span class="o">=</span><span class="n">DUMP</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="n">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span> <span class="n">SHOW</span> <span class="n">VARIABLES</span> <span class="n">LIKE</span> <span class="s1">&#39;mroonga_log_level&#39;</span><span class="p">;</span>
<span class="o">+-------------------+-------+</span>
<span class="o">|</span> <span class="n">Variable_name</span>     <span class="o">|</span> <span class="n">Value</span> <span class="o">|</span>
<span class="o">+-------------------+-------+</span>
<span class="o">|</span> <span class="n">mroonga_log_level</span> <span class="o">|</span> <span class="n">DUMP</span>  <span class="o">|</span>
<span class="o">+-------------------+-------+</span>
<span class="mi">1</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">set</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
</div>
<p>Available log levels are the followings.</p>
<ul class="simple">
<li><p>NONE</p></li>
<li><p>EMERG</p></li>
<li><p>ALERT</p></li>
<li><p>CRIT</p></li>
<li><p>ERROR</p></li>
<li><p>WARNING</p></li>
<li><p>NOTICE</p></li>
<li><p>INFO</p></li>
<li><p>DEBUG</p></li>
<li><p>DUMP</p></li>
</ul>
<p>See <a class="reference internal" href="../reference/server_variables.html#server-variable-mroonga-log-level"><span class="std std-ref">mroonga_log_level</span></a> about details.</p>
<p>You can reopen the log file by FLUSH LOGS. If you want to rotate the log file without stopping MySQL server, you can do in the following procedure.</p>
<ol class="arabic simple">
<li><p>change the file name of <code class="docutils literal notranslate"><span class="pre">groonga.log</span></code> (by using OS’s mv command etc.).</p></li>
<li><p>invoke “FLUSH LOGS” in MySQL server (by mysql command or mysqladmin command).</p></li>
</ol>
</section>
<section id="next-step">
<h2><span class="section-number">4.4.8. </span>Next step<a class="headerlink" href="#next-step" title="Permalink to this heading">¶</a></h2>
<p>Now, you can use Mroonga as wrapper mode! If you want Mroonga to be
faster, see also <a class="reference internal" href="../reference/optimizations.html"><span class="doc">Optimizations</span></a>.</p>
<p class="rubric">Footnotes</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="score" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="http://dev.mysql.com/doc/refman/5.1/ja/fulltext-search.html">MySQL 5.1 Reference Manual :: 11 Functions and Operations :: 11.7 Full-Text Search Functions</a></p>
</aside>
<aside class="footnote brackets" id="parser" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>In Groonga, we call it a ‘tokenizer’.</p>
</aside>
</aside>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">4.4. Wrapper mode</a><ul>
<li><a class="reference internal" href="#how-to-use-wrapper-mode">4.4.1. How to use wrapper mode</a></li>
<li><a class="reference internal" href="#how-to-use-full-text-search">4.4.2. How to use full text search</a></li>
<li><a class="reference internal" href="#how-to-get-search-score">4.4.3. How to get search score</a></li>
<li><a class="reference internal" href="#how-to-specify-the-parser-for-full-text-search">4.4.4. How to specify the parser for full text search</a></li>
<li><a class="reference internal" href="#how-to-specify-the-normalizer">4.4.5. How to specify the normalizer</a></li>
<li><a class="reference internal" href="#how-to-get-snippet-keyword-in-context">4.4.6. How to get snippet (Keyword in context)</a></li>
<li><a class="reference internal" href="#logging">4.4.7. Logging</a></li>
<li><a class="reference internal" href="#next-step">4.4.8. Next step</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="storage.html"
                          title="previous chapter"><span class="section-number">4.3. </span>Storage mode</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="../reference.html"
                          title="next chapter"><span class="section-number">5. </span>Reference</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../reference.html" title="5. Reference"
             >next</a> |</li>
        <li class="right" >
          <a href="storage.html" title="4.3. Storage mode"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Mroonga v13.01 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../tutorial.html" ><span class="section-number">4. </span>Tutorial</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">4.4. </span>Wrapper mode</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2009-2023, Mroonga Project.
    </div>
      <script src="http://connect.facebook.net/en_US/all.js"></script>

    <script>
      FB.init({
         appId  : null,
         status : true, // check login status
         cookie : true, // enable cookies to allow the server to access the session
         xfbml  : true  // parse XFBML
      });
    </script>
  </body>

</html>